# G-Compress ç ”ç©¶å‘ç°æ±‡æ€»
# æ¯æ¬¡å®éªŒåç”± researcher agent æ›´æ–°

# C1: é‡åŒ–ç°è±¡
C1_quantify:
  - id: "F1.1"
    date: "2026-01-19"
    experiment: "S1_sdpa_dense_sweep"
    finding: "head_dim=107 å¯¼è‡´ SDPA å»¶è¿Ÿ 2.147ms, æ¯” head_dim=96 (1.140ms) å¢åŠ  88%"
    evidence_path: "results/S1/20260119_224805_S1_sdpa_dense_sweep/"
    confidence: "high"

  - id: "F1.2"
    date: "2026-01-19"
    experiment: "S2_sdpa_backend_forced"
    finding: "head_dim=107 æ—¶ Math backend å»¶è¿Ÿ 26.995ms, Flash backend 2.139ms, ç›¸å·® 12.6x"
    evidence_path: "results/S2/"
    confidence: "high"

  - id: "F1.3"
    date: "2026-01-21"
    experiment: "palu_dim_distribution"
    finding: "PaLU å‹ç¼©å head_dim åˆ†å¸ƒä¸è§„åˆ™ï¼Œå¤§é‡ç»´åº¦ä¸æ˜¯ 8/16/32 çš„å€æ•°"
    evidence_path: "results/palu_dim_dist/"
    confidence: "high"

  - id: "F1.4"
    date: "2026-01-24"
    experiment: "palu_dim_distribution (extended)"
    finding: "Mistral-7B å’Œ Llama-3-8B ä½¿ç”¨ PaLU r=0.8 å‹ç¼©åï¼Œper-head dim é›†ä¸­åœ¨ 114-125 èŒƒå›´ï¼Œå…¶ä¸­åªæœ‰ 120 æ˜¯ 8 çš„å€æ•°ï¼ˆ~3%ï¼‰ï¼Œå…¶ä½™å…¨éƒ¨ä¸å¯¹é½"
    evidence_path: "results/palu_dim_dist/llama3_r0.8/"
    confidence: "high"
    details:
      mistral_dims: [114, 115, 116, 118, 119, 120, 121, 122, 123, 124, 125]
      llama3_dims: [114, 116, 117, 118, 120, 121, 122, 123, 124, 125]
      aligned_8_count: "1 out of 11 unique values"

  - id: "F1.5"
    date: "2026-01-19"
    experiment: "G3_gemm_k_dense"
    finding: "GEMM K ç»´åº¦ä¸å¯¹é½æ—¶æ€§èƒ½ä¸‹é™ï¼ŒK=64-160 èŒƒå›´çš„ dense sweep æ˜¾ç¤ºå‘¨æœŸæ€§æ€§èƒ½æ³¢åŠ¨"
    evidence_path: "results/G3/"
    confidence: "high"

  - id: "F1.6"
    date: "2026-01-19"
    experiment: "P1_padding_rescue"
    finding: "å°† head_dim=107 padding åˆ° 112 æˆ– 128 å¯æ¢å¤å¤§éƒ¨åˆ†æ€§èƒ½"
    evidence_path: "results/P1/"
    confidence: "high"

# C2: åŸå› æ¢ç©¶
C2_probe:
  layer_2_1_pytorch:
    - id: "F2.1.1"
      date: "2026-01-24"
      experiment: "C21_backend_selection"
      finding: "FlashAttention åœ¨ 104-128 èŒƒå›´å†…å¯¹æ‰€æœ‰ç»´åº¦éƒ½å¯ç”¨ï¼ŒåŒ…æ‹¬é 8-aligned ç»´åº¦"
      evidence_path: "results/C21/20260124_212113_C21_backend_selection/"
      confidence: "high"
      details:
        tested_dims: [104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128]
        flash_available: "50/50 (100%)"
        detected_backend: "FLASH (all dims)"
      implication: "PyTorch åç«¯é€‰æ‹©ä¸æ˜¯æ€§èƒ½å·®è·çš„æ ¹å› ï¼ŒFlashAttention å¹¶æœªå›é€€åˆ° MATH"

    - id: "F2.1.2"
      date: "2026-01-24"
      experiment: "C21_backend_selection"
      finding: "MEM_EFFICIENT åç«¯ä»…å¯¹ 8-aligned ç»´åº¦å¯ç”¨ï¼Œé 8-aligned ç»´åº¦å®Œå…¨ä¸å¯ç”¨"
      evidence_path: "results/C21/20260124_212113_C21_backend_selection/"
      confidence: "high"
      details:
        mem_efficient_8_aligned: "8/8 (100%)"
        mem_efficient_non_aligned: "0/42 (0%)"
      implication: "xFormers/MEM_EFFICIENT æœ‰ä¸¥æ ¼çš„ 8-aligned è¦æ±‚"

    - id: "F2.1.3"
      date: "2026-01-24"
      experiment: "C21_backend_selection"
      finding: "FlashAttention å†…éƒ¨å¯¹é 8-aligned è¾“å…¥æœ‰ 30-45% çš„æ€§èƒ½æƒ©ç½š"
      evidence_path: "results/C21/20260124_212113_C21_backend_selection/"
      confidence: "high"
      details:
        avg_latency_8_aligned: "1.553 ms"
        avg_latency_non_aligned: "2.033 ms"
        slowdown: "+30.9%"
        palu_range_114_119:
          latency: "2.22-2.24 ms"
          vs_d120: "+38-39%"
      implication: "æ€§èƒ½å·®è·å‘ç”Ÿåœ¨ FlashAttention å†…éƒ¨ï¼Œè€Œéåç«¯é€‰æ‹©å±‚"

    - id: "F2.1.4"
      date: "2026-01-24"
      experiment: "C21_backend_selection"
      finding: "éå¯¹é½ç»´åº¦çš„å»¶è¿Ÿå‘ˆé˜¶æ¢¯çŠ¶åˆ†å¸ƒï¼Œä¸ padding åˆ°ä¸‹ä¸€ä¸ª 8-aligned çš„å¼€é”€æ— å…³"
      evidence_path: "results/C21/20260124_212113_C21_backend_selection/"
      confidence: "high"
      details:
        example: "D=113-119 å»¶è¿Ÿçº¦ 2.23msï¼Œè¿œé«˜äº D=120 çš„ 1.61ms"
        pattern: "éå¯¹é½ç»´åº¦å»¶è¿Ÿå‡ ä¹æ’å®šï¼Œä¸å…·ä½“æ•°å€¼æ— å…³"
      implication: "FlashAttention å¯¹éå¯¹é½è¾“å…¥ä½¿ç”¨äº†ä¸åŒçš„æ‰§è¡Œè·¯å¾„"

  layer_2_2_cuda: []

  layer_2_3_hardware:
    - id: "F2.3.1"
      date: "2026-01-24"
      experiment: "C23_hardware_layer_analysis"
      finding: "Tensor Core åˆ©ç”¨ç‡åœ¨ 16-aligned K ç»´åº¦æ—¶æ˜¾è‘—é«˜äºéå¯¹é½ç»´åº¦"
      evidence_path: "results/C23/20260124_220005_C23_hardware_layer/"
      confidence: "high"
      hypothesis_status: "CONFIRMED"
      details:
        gemm_shape: "8192 x 8192 x K"
        aligned_16_tflops: 91.1
        aligned_8_only_tflops: 76.8
        non_aligned_tflops: 58.1
        slowdown_non_vs_16: "58.1%"
        tc_utilization_aligned: "~30%"
        tc_utilization_non_aligned: "~12%"
        key_observation: "K=105,107,109... ç­‰å¥‡æ•°ç»´åº¦è¡¨ç°æœ€å·® (~37-55 TFLOPS)"
      implication: "GEMM å†…æ ¸å¯¹ K ç»´åº¦æœ‰ 16-alignment ä¼˜åŒ–è·¯å¾„ï¼Œæ˜¯æ€§èƒ½å·®è·çš„ä¸»å› ä¹‹ä¸€"
      impact: "HIGH - 58% slowdown"

    - id: "F2.3.2"
      date: "2026-01-24"
      experiment: "C23_hardware_layer_analysis"
      finding: "L2 cache sector æµªè´¹å¯¹å¸¦å®½æ•ˆç‡å½±å“æœ‰é™ (~5.8%)ï¼Œä¸æ˜¯ä¸»è¦ç“¶é¢ˆ"
      evidence_path: "results/C23/20260124_220005_C23_hardware_layer/"
      confidence: "high"
      hypothesis_status: "NOT CONFIRMED"
      details:
        aligned_16_bandwidth_gbs: 209.3
        non_aligned_bandwidth_gbs: 214.6
        avg_sector_waste_pct: 5.8
        observation: "éå¯¹é½ç»´åº¦çš„å¸¦å®½åè€Œç•¥é«˜ï¼Œè¯´æ˜ sector æµªè´¹ä¸æ˜¯ä¸»å› "
      implication: "L2 cache ä¸æ˜¯æ€§èƒ½å·®è·çš„æ ¹å› "
      impact: "LOW - 5.8% waste, negligible"

    - id: "F2.3.3"
      date: "2026-01-24"
      experiment: "C23_hardware_layer_analysis"
      finding: "å‘é‡åŒ–åŠ è½½æ¨¡å¼å¯¹ GEMM æ€§èƒ½æœ‰æ˜¾è‘—å½±å“"
      evidence_path: "results/C23/20260124_220005_C23_hardware_layer/"
      confidence: "high"
      hypothesis_status: "CONFIRMED"
      details:
        float4_aligned_16:
          K_values: [112, 128]
          tflops: "73-83"
        float4_aligned_8:
          K_values: [104, 120]
          tflops: "68-77"
        float2_aligned_4:
          K_values: [108, 116, 124]
          tflops: "61-71"
        scalar_non_aligned:
          K_values: [105, 107]
          tflops: "39-40"
      implication: "float4 å‘é‡åŒ–åŠ è½½éœ€è¦ 8-alignedï¼Œéå¯¹é½ç»´åº¦é™çº§ä¸º scalar å¯¼è‡´æ€§èƒ½ä¸‹é™"
      impact: "HIGH - 50% throughput loss"

    - id: "F2.3.4"
      date: "2026-01-24"
      experiment: "C23_hardware_layer_analysis"
      finding: "SDPA å†…å­˜å¸¦å®½æ•ˆç‡ä¸ 8-alignment å¼ºç›¸å…³"
      evidence_path: "results/C23/20260124_220005_C23_hardware_layer/"
      confidence: "high"
      hypothesis_status: "CONFIRMED"
      details:
        sdpa_d112_latency_ms: 1.529
        sdpa_d113_latency_ms: 2.208
        sdpa_d120_latency_ms: 1.571
        sdpa_d121_latency_ms: 2.142
        bandwidth_8_aligned: "153-160 GB/s"
        bandwidth_non_aligned: "107-118 GB/s"
        bandwidth_ratio: "~1.4x"
      implication: "SDPA å¯¹é 8-aligned ç»´åº¦æœ‰ ~40% çš„å¸¦å®½æ•ˆç‡æŸå¤±"
      impact: "HIGH - 40% efficiency loss"

  layer_2_3_summary:
    status: "COMPLETED"
    date: "2026-01-24"
    hypotheses_tested: 4
    confirmed: 3
    not_confirmed: 1
    root_causes_by_impact:
      - rank: 1
        cause: "Tensor Core tile alignment"
        impact: "58% slowdown"
        requirement: "K % 16 == 0"
      - rank: 2
        cause: "å‘é‡åŒ–åŠ è½½é™çº§"
        impact: "50% throughput loss"
        requirement: "K % 8 == 0 for float4"
      - rank: 3
        cause: "SDPA å¸¦å®½æ•ˆç‡"
        impact: "40% efficiency loss"
        requirement: "head_dim % 8 == 0"
      - rank: 4
        cause: "L2 cache sector æµªè´¹"
        impact: "5.8% (negligible)"
        status: "éä¸»å› "
    alignment_constraints:
      minimal: "head_dim % 8 == 0"
      optimal: "head_dim % 16 == 0"
      recommended_values: [64, 96, 112, 128]

# C3: å½¢å¼åŒ–
C3_formulate:
  - id: "F3.1"
    date: "2026-01-24"
    finding: "ShapeContract æ•°æ®ç»“æ„å®šä¹‰å®Œæˆï¼Œå½¢å¼åŒ–äº†ç»´åº¦å¯¹é½çº¦æŸ"
    implementation: "src/gcompress_bench/dimension_repair.py"
    details:
      minimal_alignment: 8
      optimal_alignment: 16
      recommended_values: [32, 64, 96, 112, 128, 160, 192, 224, 256]
      max_overhead_pct: 20.0
    confidence: "high"

  - id: "F3.2"
    date: "2026-01-24"
    finding: "repair_dimension() å‡½æ•°å®ç° 4 ç§ä¿®å¤ç­–ç•¥"
    implementation: "src/gcompress_bench/dimension_repair.py:repair_dimension()"
    details:
      strategies:
        minimal: "å¯¹é½åˆ° 8ï¼Œæœ€å°å†…å­˜å¼€é”€"
        optimal: "å¯¹é½åˆ° 16ï¼Œæœ€ä¼˜ Tensor Core"
        predefined: "å¯¹é½åˆ°é¢„å®šä¹‰å¿«é€Ÿè·¯å¾„"
        tradeoff: "æ ¹æ®å¼€é”€é˜ˆå€¼è‡ªåŠ¨é€‰æ‹©"
    confidence: "high"

# C4: è§£å†³æ–¹æ¡ˆ
C4_solver:
  - id: "F4.1"
    date: "2026-01-24"
    finding: "DimensionRepairer ç±»å®ç°äº†æ¨¡å‹çº§åˆ«çš„ç»´åº¦ä¿®å¤"
    implementation: "src/gcompress_bench/dimension_repair.py:DimensionRepairer"
    details:
      methods:
        - analyze_model: è¯†åˆ«éœ€è¦ä¿®å¤çš„ç»´åº¦
        - compute_repair_plan: è®¡ç®—ä¿®å¤æ–¹æ¡ˆ
        - repair_linear_layer: ä¿®å¤å•ä¸ª Linear å±‚
        - repair_model: ä¿®å¤æ•´ä¸ªæ¨¡å‹
    confidence: "high"

  - id: "F4.2"
    date: "2026-01-24"
    finding: "PaLU å‹ç¼©æ¨¡å‹ç»´åº¦ä¿®å¤éªŒè¯æˆåŠŸ"
    experiment: "C4_dimension_repair (Job 18424)"
    status: "completed"
    evidence_path: "results/C4/20260124_221749_C4_dimension_repair/"
    details:
      palu_dims_distribution:
        total_heads: 512
        originally_aligned: 3.1%
        misaligned_pct: 96.9%
      actual_overhead:
        minimal_strategy: 3.72%
        optimal_strategy: 7.2%
      benchmark_speedups:
        dim_107: "2.064ms â†’ 1.490ms (+27.8%)"
        dim_114: "2.049ms â†’ 1.549ms (+24.4%)"
        dim_117: "2.054ms â†’ 1.567ms (+23.7%)"
        dim_121: "1.964ms â†’ 1.430ms (+27.2%)"
        dim_125: "1.975ms â†’ 1.439ms (+27.1%)"
      key_observation: "D=120 å·²å¯¹é½æ— æå‡ (1.557ms)ï¼ŒéªŒè¯äº†å¯¹é½å‡è®¾"
    confidence: "high"

  - id: "F4.3"
    date: "2026-01-24"
    finding: "Dimension repair ç®—æ³•æ­£ç¡®æ€§éªŒè¯é€šè¿‡ (30/30 tests)"
    experiment: "C4_dimension_repair"
    evidence_path: "results/C4/20260124_221749_C4_dimension_repair/results.json"
    details:
      repair_dimension_tests: 22/22
      shape_contract_tests: 8/8
      palu_dimension_repairs:
        114: 120
        116: 120
        117: 120
        118: 120
        120: 120
        121: 128
        122: 128
        123: 128
        124: 128
        125: 128
    confidence: "high"

# C5: éªŒè¯
C5_validation:
  - id: "F5.1"
    date: "2026-01-25"
    experiment: "C5_e2e_comparison (Job 18425)"
    finding: "C5 ç«¯åˆ°ç«¯éªŒè¯å®éªŒå­˜åœ¨æ–¹æ³•è®ºé—®é¢˜ï¼Œç»´åº¦åˆ†æä»£ç æ£€æµ‹åˆ° 0% misalignment"
    status: "FAILED - needs re-run"
    evidence_path: "results/C5/20260125_000525_C5_e2e_comparison/"
    confidence: "high"
    issue_analysis:
      observed: |
        - PaLU æ¨¡å‹ unique_dims: [320, 384, 448, 512, 576, 704, 768, 832, 896, 960, 1024]
        - misaligned_pct: 0.0%
        - total_heads: 192
      expected: |
        - æ ¹æ® C4 å’Œ palu_dim_dist æ•°æ®ï¼Œper-head dims åº”ä¸º [114-125]
        - misaligned_pct: ~97%
        - total_heads: 512
      root_cause: |
        analyze_palu_dimensions() å‡½æ•°æŸ¥çœ‹çš„æ˜¯ k_proj/v_proj çš„ out_featuresï¼Œ
        è¿™æ˜¯ PaLU åˆ†è§£åçš„ GROUP çº§åˆ«ç»´åº¦ï¼ˆå·²æ˜¯ 64 çš„å€æ•°ï¼‰ï¼Œ
        è€Œä¸æ˜¯ per-HEAD çº§åˆ«çš„ç»´åº¦ï¼ˆ114-125 èŒƒå›´å†…å¤§éƒ¨åˆ†ä¸å¯¹é½ï¼‰
      impact: |
        ç”±äº PaLU æ¨¡å‹åœ¨ C5 å®éªŒä¸­è¢«é”™è¯¯è¯†åˆ«ä¸ºã€Œå·²å¯¹é½ã€ï¼Œ
        dimension repair å®é™…ä¸Šæ²¡æœ‰ç”Ÿæ•ˆ (affected_layers: 0)ï¼Œ
        å¯¼è‡´ palu å’Œ palu_repair çš„æ€§èƒ½å‡ ä¹ç›¸åŒ

  - id: "F5.2"
    date: "2026-01-25"
    experiment: "C5_e2e_comparison"
    finding: "å°½ç®¡ C5 æ–¹æ³•æœ‰é—®é¢˜ï¼Œbaseline/decode å¯¹æ¯”ä»æœ‰ä»·å€¼"
    evidence_path: "results/C5/20260125_000525_C5_e2e_comparison/"
    confidence: "medium"
    details:
      baseline_prefill_tok_s: 9870
      baseline_decode_tok_s: 119
      palu_prefill_tok_s: 9672
      palu_decode_tok_s: 1371
      palu_decode_speedup: "11.5x"
      observation: |
        PaLU åœ¨ decode é˜¶æ®µç›¸æ¯” baseline æœ‰ 11.5x çš„ååé‡æå‡ã€‚
        è¿™æ˜¯å› ä¸º PaLU å‹ç¼©å‡å°‘äº† KV cache å¤§å°ï¼Œdecode é˜¶æ®µæ˜¯ memory-boundã€‚
        ä½†è¿™ä¸èƒ½è¯æ˜ dimension repair çš„æœ‰æ•ˆæ€§ã€‚
    implication: |
      C5 å®éªŒéªŒè¯äº† PaLU å‹ç¼©å¯¹ decode é˜¶æ®µæœ‰æ˜¾è‘—åŠ é€Ÿï¼ˆ11.5xï¼‰ï¼Œ
      ä½†ç”±äºç»´åº¦åˆ†æé”™è¯¯ï¼Œæ— æ³•éªŒè¯ dimension repair çš„ç«¯åˆ°ç«¯æ•ˆæœ

  - id: "F5.3"
    date: "2026-01-25"
    experiment: "C5_e2e_comparison"
    finding: "å†…å­˜æµ‹é‡å¼‚å¸¸ï¼špalu_repair å†…å­˜å¼€é”€ 81%"
    evidence_path: "results/C5/20260125_000525_C5_e2e_comparison/comparison.json"
    confidence: "high"
    details:
      baseline_mb: 19003
      palu_mb: 18896
      palu_repair_mb: 34233
      repair_overhead_pct: 81.2
    issue_analysis: |
      palu_repair å†…å­˜å¼€é”€ 81% è¿œè¶…é¢„æœŸçš„ <5%ã€‚
      å¯èƒ½åŸå› ï¼š
      1. repair åˆ›å»ºäº†æ–°çš„æ¨¡å‹å‰¯æœ¬ï¼ˆinplace=Falseï¼‰
      2. ä¸¤ä¸ªæ¨¡å‹åŒæ—¶åœ¨ GPU ä¸Š
      è¿™æ˜¯å®éªŒè„šæœ¬é—®é¢˜ï¼Œé dimension repair ç®—æ³•é—®é¢˜

  - id: "F5.4"
    date: "2026-01-25"
    finding: "C5 éªŒè¯éœ€è¦ä¿®å¤çš„é—®é¢˜æ¸…å•"
    action_items:
      - item: "ä¿®å¤ analyze_palu_dimensions() å‡½æ•°"
        description: |
          éœ€è¦æ·±å…¥ PaLU æ¨¡å‹ç»“æ„ï¼Œæ‰¾åˆ° per-head çš„å‹ç¼©ç»´åº¦ã€‚
          å¯èƒ½éœ€è¦æŸ¥çœ‹ PaluLlamaConfig ä¸­çš„ low_rank_* å‚æ•°ï¼Œ
          æˆ–è€… k_proj/v_proj æ¨¡å—çš„ U/VT åˆ†è§£ç»´åº¦
      - item: "ä¿®å¤ DimensionRepairer å¯¹ PaLU æ¨¡å‹çš„é€‚é…"
        description: |
          å½“å‰ DimensionRepairer å¯èƒ½æ²¡æœ‰æ­£ç¡®è¯†åˆ« PaLU çš„ä½ç§©åˆ†è§£å±‚
      - item: "ä¿®å¤å†…å­˜æµ‹é‡é€»è¾‘"
        description: |
          åœ¨ repair ååº”é‡Šæ”¾åŸæ¨¡å‹ï¼Œé¿å…ä¸¤ä¸ªæ¨¡å‹åŒæ—¶å ç”¨æ˜¾å­˜
      - item: "é‡æ–°è¿è¡Œ C5 å®éªŒ"
        description: |
          ä¿®å¤ä¸Šè¿°é—®é¢˜åï¼Œä½¿ç”¨æ­£ç¡®çš„ç»´åº¦åˆ†æå’Œ repair é€»è¾‘é‡æ–°éªŒè¯

  - id: "F5.5"
    date: "2026-01-27"
    experiment: "M2_E2E_RAP_SVD_Compression (Job 18533)"
    finding: "RAP SVD å‹ç¼©æˆåŠŸç”Ÿæˆ 100% ä¸å¯¹é½ç»´åº¦çš„ Llama-3-8B æ¨¡å‹"
    status: "COMPLETED"
    evidence_path: "results/rap_svd_misaligned/"
    confidence: "high"
    details:
      job_id: 18533
      model_path: "results/rap_svd_misaligned/llama3_8b_svd_r0.8.pt"
      model_size_gb: 15.2
      dims_json_path: "results/rap_svd_misaligned/dims.json"
      compression_method: "RAP SVD (no alignment constraint)"
      retain_ratio: 0.8
      original_head_dim: 128
      compressed_head_dim: 102
      alignment_check: "102 % 8 = 6 (NOT aligned)"
      total_layers: 32
      k_aligned_8_count: 0
      k_aligned_8_pct: 0.0
      k_misaligned_8_pct: 100.0
      unique_k_ranks: [102]
      unique_v_ranks: [102]
    code_analysis:
      rap_svd_formula: "rank_per_head = round(head_dim * retain_ratio)"
      code_location: "third_party/RAP/prune.py:775"
      no_alignment_constraint: true
    contrast_with_palu:
      palu_formula: "rounding_search_result(config, block_size=32)"
      palu_always_aligned: true
    supports_claim: "éé‡åŒ– SVD å‹ç¼©ä¼šäº§ç”Ÿä¸å¯¹é½ç»´åº¦ï¼Œå¯¼è‡´ GPU æ€§èƒ½ä¸‹é™"
    paper_section: "Section 5 (E2E Validation)"
    figure_ref: "Figure 6"
    next_steps:
      - "è¿è¡Œ E2E benchmark: RAP_SVD vs RAP_SVD+Repair"
      - "æµ‹é‡ speedup å¹¶æ›´æ–°è®ºæ–‡ Figure 6"

  - id: "F5.6"
    date: "2026-01-27"
    experiment: "M1_E2E_REPAIR (Job 18546)"
    finding: "RAP SVD E2E å®éªŒéƒ¨åˆ†å¤±è´¥ï¼šä»… Prefill é˜¶æ®µå®Œæˆï¼ŒDecode å’Œ Repair å¤±è´¥"
    status: "PARTIALLY_FAILED"
    evidence_path: "results/rap_svd_e2e/20260127_130226/"
    confidence: "high"
    details:
      job_id: 18546
      node: "acclnode06"
      gpu: "A100 80GB PCIe"
      phases_completed:
        misaligned_prefill: "6/6 âœ…"
        misaligned_decode: "0/8 âŒ"
        repaired_prefill: "0/6 âŒ"
        repaired_decode: "0/8 âŒ"
      decode_error:
        type: "TypeError"
        message: "DynamicCache.__init__() got an unexpected keyword argument 'config'"
        cause: "transformers 4.39.3 ç‰ˆæœ¬çš„ DynamicCache ä¸æ¥å— config å‚æ•°"
      repair_error:
        type: "RuntimeError"
        message: "The expanded size of the tensor (102) must match the existing size (816)"
        cause: |
          apply_dimension_repair() å‡è®¾æƒé‡å½¢çŠ¶æ˜¯ [k_rank, hidden]
          å®é™… RAP SVD æƒé‡å½¢çŠ¶æ˜¯ [num_heads * k_rank_per_head, hidden] = [8*102, 4096] = [816, 4096]
          éœ€è¦æŒ‰ group-level å¤„ç†ï¼Œè€Œé per-head
    fixes_needed:
      - item: "ä¿®å¤ apply_dimension_repair() å‡½æ•°"
        priority: "critical"
        description: "é€‚é… RAP SVD çš„å¼ é‡å¸ƒå±€ï¼š[num_heads * k_rank_per_head, hidden]"
      - item: "ä¿®å¤ DynamicCache å…¼å®¹æ€§"
        priority: "medium"
        description: "ç§»é™¤ config å‚æ•°æˆ–æ¡ä»¶åˆ¤æ–­ transformers ç‰ˆæœ¬"
    supports_claim: "N/A - å®éªŒæœªå®Œæˆ"
    paper_section: "Section 5 (E2E Validation)"
    figure_ref: "Figure 6 (æœªç”Ÿæˆ)"

  - id: "F5.7"
    date: "2026-01-27"
    experiment: "M1_E2E_REPAIR (Job 18546)"
    finding: "RAP SVD (d=102, 100%ä¸å¯¹é½) Prefill æ€§èƒ½åŸºçº¿æ•°æ®"
    status: "COMPLETED"
    evidence_path: "results/rap_svd_e2e/20260127_130226/misaligned_results.json"
    confidence: "high"
    details:
      model: "Llama-3-8B + RAP SVD (r=0.8)"
      head_dim: 102
      alignment: "102 % 8 = 6 (ä¸å¯¹é½)"
      model_size_mb: 15451
      prefill_results:
        - config: "batch=1, seq=512"
          latency_ms: 61.46
          latency_std: 0.18
          throughput_tok_s: 8330
          cv_pct: 0.29
        - config: "batch=4, seq=512"
          latency_ms: 210.92
          latency_std: 1.03
          throughput_tok_s: 9710
          cv_pct: 0.49
        - config: "batch=1, seq=1024"
          latency_ms: 126.39
          latency_std: 0.46
          throughput_tok_s: 8102
          cv_pct: 0.36
        - config: "batch=4, seq=1024"
          latency_ms: 464.85
          latency_std: 1.08
          throughput_tok_s: 8811
          cv_pct: 0.23
        - config: "batch=1, seq=2048"
          latency_ms: 290.54
          latency_std: 0.70
          throughput_tok_s: 7049
          cv_pct: 0.24
        - config: "batch=4, seq=2048"
          latency_ms: 1134.19
          latency_std: 0.99
          throughput_tok_s: 7223
          cv_pct: 0.09
      data_quality: "CV < 1% for all configs, data is very stable"
    key_observation: |
      Misaligned prefill æ•°æ®æœ‰æ•ˆï¼Œå¯ä½œä¸º baselineã€‚
      ä½†ç¼ºå°‘ repaired å¯¹æ¯”æ•°æ®ï¼Œæ— æ³•éªŒè¯ E2E repair speedupã€‚
    supports_claim: "Baseline for dimension repair comparison"
    paper_section: "Section 5 (E2E Validation)"
    figure_ref: "Figure 6 (å¾…å¯¹æ¯”æ•°æ®)"

c5_status_summary:
  date: "2026-01-27"
  status: "BLOCKED - E2E benchmark code needs fixes"
  previous_blocker: |
    æ‰€æœ‰å¯ç”¨çš„ PaLU checkpointï¼ˆratio 0.5-0.9ï¼‰éƒ½ä½¿ç”¨äº† 32-å€æ•°é‡åŒ–çº¦æŸï¼Œ
    ç»´åº¦ 100% å¯¹é½ã€‚ç»´åº¦åå¡Œé—®é¢˜ä¸å­˜åœ¨äºå½“å‰å¯ç”¨æ¨¡å‹ä¸­ã€‚
  solution_found: "2026-01-26"
  solution: |
    **å‘ç° RAP SVD æ–¹æ¡ˆä¸å¼ºåˆ¶å¯¹é½ï¼**

    å¯¹æ¯”ä¸‰ç§å‹ç¼©æ–¹æ¡ˆçš„å¯¹é½é€»è¾‘ï¼š
    - PaLU: `rounding_search_result(config, block_size=32)` â†’ å¼ºåˆ¶ 32 å¯¹é½
    - RAP SVD: `round(head_dim * retain_ratio)` â†’ ä»»æ„æ•´æ•°ï¼Œæ— å¯¹é½çº¦æŸ
    - RAP: åªè¦æ±‚å¶æ•°ï¼ˆRoPE pair éœ€è¦ï¼‰

    ä»£ç ä½ç½®ï¼š
    - PaLU å¯¹é½: third_party/palu/palu/rank_search.py:11-17, block_size=32
    - RAP SVD æ— å¯¹é½: third_party/RAP/prune.py:775

    ç¤ºä¾‹ï¼šretain_ratio=0.8, head_dim=128
    - RAP SVD: round(128 * 0.8) = 102 â† ä¸æ˜¯ 8 çš„å€æ•°ï¼
    - PaLU: round(102 / 32) * 32 = 96 â† å¼ºåˆ¶å¯¹é½
  validated: true
  validation_date: "2026-01-27"
  next_action: |
    âœ… COMPLETED:
    1. ä½¿ç”¨ RAP SVD å‹ç¼©æ¨¡å‹ç”Ÿæˆä¸å¯¹é½ç»´åº¦ - Job 18533 å®Œæˆ
    2. éªŒè¯ç”Ÿæˆçš„æ¨¡å‹ rank ç¡®å®ä¸å¯¹é½ - 100% ä¸å¯¹é½ (head_dim=102)
    3. è¿è¡Œ E2E benchmark (Job 18546) - éƒ¨åˆ†å®Œæˆ

    âŒ FAILED - éœ€è¦ä¿®å¤:
    4. apply_dimension_repair() å‡½æ•° - å¼ é‡å½¢çŠ¶ä¸åŒ¹é…
    5. DynamicCache API å…¼å®¹æ€§ - transformers ç‰ˆæœ¬é—®é¢˜

    ğŸ“Š éƒ¨åˆ†æˆåŠŸ:
    - Misaligned prefill æ•°æ®æœ‰æ•ˆ (6/6 é…ç½®)
    - æ•°æ®ç¨³å®šæ€§å¥½ (CV < 1%)

    â³ REMAINING:
    6. ä¿®å¤ä»£ç åé‡æ–°è¿è¡Œ repair benchmark
    7. ç”Ÿæˆ comparison.json å’Œ latency_plot.pdf
    8. æ›´æ–°è®ºæ–‡ Figure 6

  # 2026-01-27 M1_E2E_REPAIR å®éªŒè®°å½•
  m1_e2e_experiment:
    job_id: 18546
    date: "2026-01-27"
    status: "PARTIALLY_FAILED"
    result_path: "results/rap_svd_e2e/20260127_130226/"
    phases:
      misaligned_prefill: "SUCCESS - 6/6 configs"
      misaligned_decode: "FAILED - DynamicCache API"
      repaired_prefill: "FAILED - tensor shape mismatch"
      repaired_decode: "NOT_RUN"
    valid_data:
      - "misaligned_results.json - prefill éƒ¨åˆ†"
    missing_data:
      - "repaired_results.json"
      - "comparison.json"
      - "latency_plot.pdf"
    errors:
      decode_error: "DynamicCache.__init__() got unexpected keyword argument 'config'"
      repair_error: "tensor size mismatch: expected [102, 4096], got [816, 4096]"
    root_cause: |
      apply_dimension_repair() å‡è®¾ RAP SVD æƒé‡å½¢çŠ¶æ˜¯ [k_rank_per_head, hidden]ï¼Œ
      å®é™…å½¢çŠ¶æ˜¯ [num_heads * k_rank_per_head, hidden] = [8 * 102, 4096] = [816, 4096]ã€‚
      éœ€è¦ä¿®æ”¹ repair é€»è¾‘æŒ‰ group-level å¤„ç†å¼ é‡ã€‚

  # 2026-01-27 M2 å®éªŒæˆåŠŸè®°å½•
  m2_experiment_success:
    job_id: 18533
    date: "2026-01-27"
    status: "SUCCESS"
    model_path: "results/rap_svd_misaligned/llama3_8b_svd_r0.8.pt"
    dims_json_path: "results/rap_svd_misaligned/dims.json"
    compression_method: "RAP SVD (no alignment constraint)"
    retain_ratio: 0.8
    original_head_dim: 128
    compressed_head_dim: 102
    alignment_analysis:
      total_layers: 32
      k_aligned_8_count: 0
      k_aligned_8_pct: 0.0
      k_misaligned_8_pct: 100.0
      unique_k_ranks: [102]
      unique_v_ranks: [102]
    key_finding: |
      RAP SVD å‹ç¼©æˆåŠŸç”Ÿæˆäº† 100% ä¸å¯¹é½çš„ç»´åº¦ï¼
      - æ‰€æœ‰ 32 å±‚çš„ k_rank_per_head = 102 (102 % 8 = 6, ä¸å¯¹é½)
      - æ‰€æœ‰ 32 å±‚çš„ v_rank_per_head = 102
      è¿™éªŒè¯äº† findings.yaml ä¸­å…³äº RAP SVD ä¸å¼ºåˆ¶å¯¹é½çš„å‘ç°ã€‚
    code_fixes_applied:
      - "ALL_ATTENTION_FUNCTIONS å¯¼å…¥å…¼å®¹æ€§ä¿®å¤ (transformers < 4.44)"
      - "Unpack/TransformersKwargs å¯¼å…¥å…¼å®¹æ€§ä¿®å¤"
      - "LlamaRotaryEmbedding ç­¾åå…¼å®¹æ€§ä¿®å¤"
      - "lm_eval æ‡’åŠ è½½ä»¥é¿å… peft ä¾èµ–å†²çª"
      - "torch_dtype æ›¿ä»£ dtype å‚æ•°ä¿®å¤"
    files_modified:
      - "third_party/RAP/src/RAPAttention.py"
      - "third_party/RAP/src/SVDAttention.py"
      - "third_party/RAP/src/PaLUAttention.py"
      - "third_party/RAP/src/LlamaModel.py"
      - "third_party/RAP/src/ops.py"
    next_steps:
      - "è¿è¡Œ E2E benchmark: RAP_SVD vs RAP_SVD+Repair"
      - "æµ‹é‡ speedup å¹¶æ›´æ–°è®ºæ–‡ Figure 6"

  # 2026-01-27 M2 å®éªŒå¤±è´¥è®°å½• (å†å²)
  m2_experiment_attempt_1:
    job_id: 18530
    date: "2026-01-27"
    status: "FAILED"
    error_type: "ImportError"
    error_message: |
      cannot import name 'ALL_ATTENTION_FUNCTIONS' from 'transformers.modeling_utils'
    root_cause: |
      RAP ä»£ç ä½¿ç”¨äº† transformers 4.44+ æ–°å¢çš„ ALL_ATTENTION_FUNCTIONS APIï¼Œ
      ä½†å½“å‰ç¯å¢ƒ transformers ç‰ˆæœ¬ä¸º 4.39.3ï¼Œå¯¼è‡´å¯¼å…¥å¤±è´¥ã€‚
    evidence:
      slurm_out: "slurm_logs/18530_rap_svd_compress.out"
      slurm_err: "slurm_logs/18530_rap_svd_compress.err"
      result_dir_empty: true
    impact: |
      - æ— æ³•ç”Ÿæˆä¸å¯¹é½ç»´åº¦çš„ RAP SVD å‹ç¼©æ¨¡å‹
      - M2 E2E validation æ— æ³•è¿›è¡Œ
      - è®ºæ–‡ C5 éªŒè¯ä»å¤„äºé˜»å¡çŠ¶æ€
    resolution_options:
      option_a:
        description: "å‡çº§ transformers åˆ° 4.44+"
        complexity: LOW
        risk: "å¯èƒ½ç ´åå…¶ä»–ä¾èµ–"
      option_b:
        description: "ä¿®æ”¹ RAP ä»£ç ç§»é™¤ ALL_ATTENTION_FUNCTIONS ä¾èµ–"
        complexity: MEDIUM
        time_estimate: "1-2 hours"
      option_c:
        description: "ä½¿ç”¨æ›¿ä»£æ–¹æ³•ï¼šæ‰‹åŠ¨æ„é€ ä¸å¯¹é½ç»´åº¦æµ‹è¯•"
        complexity: LOW
        note: "å·²æœ‰ C4 å¾®åŸºå‡†æ•°æ®å¯å¤ç”¨"

  # 2026-01-26 ç¬¬ä¸‰è½®åˆ†æ - æœ€ç»ˆç¡®è®¤
  detailed_analysis_v3:
    date: "2026-01-26"
    analyst: "researcher_agent"

    definitive_finding: |
      ç»è¿‡å…¨é¢æ£€æŸ¥æ‰€æœ‰å¯ç”¨ PaLU æ¨¡å‹ï¼ˆ24 ä¸ª checkpointï¼Œratio 0.5-0.9ï¼‰ï¼Œ
      æ‰€æœ‰æ¨¡å‹çš„ head_wise_ranks éƒ½æ˜¯ 32 çš„å€æ•°ï¼Œ100% 8-alignedã€‚

      "~97% ç»´åº¦ä¸å¯¹é½" çš„æ•°æ®æ¥æºäº RAP çš„ç†è®ºåˆ†æ
      (third_party/RAP/results/attention_size/*_retain0.8.json)ï¼Œ
      è¿™æ˜¯ Fisher ä¿¡æ¯è®¡ç®—çš„"ç†æƒ³" rank åˆ†é…ï¼Œ
      è€Œéå®é™… PaLU å‹ç¼©ç»“æœã€‚

    verified_data:
      all_palu_checkpoints_checked: 24
      all_checkpoints_8_aligned: "100%"
      rap_theoretical_analysis_aligned: "3.1%"
      source_of_97_percent_claim: "RAP ç†è®ºåˆ†æï¼Œéå®é™…æ¨¡å‹"

    code_correctness:
      analyze_palu_dimensions: |
        ä»£ç é€»è¾‘æ­£ç¡®ã€‚æ£€æµ‹ HeadwiseLowRankModule.ranks å¹¶æŠ¥å‘Š 0% misalignment
        æ˜¯å› ä¸ºå®é™…æ¨¡å‹ç»´åº¦ç¡®å®å¯¹é½ã€‚ä¸éœ€è¦ä¿®å¤ä»£ç ã€‚

    experiment_design_issue:
      description: |
        C5 å®éªŒè®¾è®¡å‡è®¾ï¼šPaLU å‹ç¼©äº§ç”Ÿä¸å¯¹é½ç»´åº¦
        å®é™…æƒ…å†µï¼šPaLU ä½¿ç”¨é‡åŒ–çº¦æŸï¼Œå¼ºåˆ¶ rank å¯¹é½åˆ° 32 çš„å€æ•°
        ç»“è®ºï¼šC5 å®éªŒçš„å‰ææ¡ä»¶ä¸æˆç«‹

    resolution:
      recommended: "æ–‡å­—ä¿®æ”¹æ–¹æ¡ˆ"
      actions:
        - "æ›´æ–°è®ºæ–‡ï¼Œæ˜ç¡® scopeï¼šç»´åº¦åå¡Œå‘ç”Ÿåœ¨éé‡åŒ– SVD å‹ç¼©åœºæ™¯"
        - "ä¿ç•™ C4 å¾®åŸºå‡†ï¼ˆä½¿ç”¨äººå·¥æ„é€ çš„ä¸å¯¹é½ç»´åº¦ï¼‰ä½œä¸ºä¸»è¦è¯æ®"
        - "C5 æ•°æ®ç”¨äºå±•ç¤º PaLU çš„ decode åŠ é€Ÿ (11.5x)ï¼Œä½†ä¸ç”¨äº repair æ•ˆæœéªŒè¯"
        - "åœ¨ limitations ä¸­è¯´æ˜ï¼šå½“å‰ PaLU å®ç°å·²å†…ç½®å¯¹é½çº¦æŸ"

  # 2026-01-26 æ·±å…¥åˆ†æ (ç¬¬ä¸€è½® - å·²è¿‡æ—¶)
  detailed_analysis_v1:
    date: "2026-01-26"
    analyst: "researcher_agent"
    status: "SUPERSEDED by v2"
    note: "åŸåˆ†æè®¤ä¸ºæ˜¯å¯¼å…¥é—®é¢˜ï¼Œå®é™…é—®é¢˜æ›´æ ¹æœ¬"

  # 2026-01-26 æ·±å…¥åˆ†æ (ç¬¬äºŒè½® - æœ€ç»ˆ)
  detailed_analysis_v2:
    date: "2026-01-26"
    analyst: "researcher_agent"

    critical_finding: |
      å½“å‰ä½¿ç”¨çš„ PaLU æ¨¡å‹ (ratio=0.7, gs=4) çš„ç»´åº¦æœ¬èº«å°±æ˜¯å®Œå…¨å¯¹é½çš„ï¼
      è¿™ä¸æ˜¯ä»£ç  bugï¼Œè€Œæ˜¯å®éªŒè®¾è®¡é—®é¢˜ã€‚

    evidence:
      - source: "PaLU config.json"
        path: "/home/xinj/rap/submodules/palu/Meta-Llama-3-8B-Instruct_ratio-0.7_gs-4-fisher_uniform-svd/config.json"
        observation: |
          head_wise_ranks ä¸­æ‰€æœ‰å€¼éƒ½æ˜¯ 32 çš„å€æ•°:
          [160, 192, 224, 256, 288, 352, 384, 416, 448, 480, 512]
          8-aligned: 100%, 16-aligned: 100%, 32-aligned: 100%
      - source: "C5 experiment output"
        path: "results/C5/20260125_000525_C5_e2e_comparison/report.md"
        observation: |
          Before/After Repair å®Œå…¨ç›¸åŒ:
          - Misaligned dimensions: 0.0%
          - Unique dims: [320, 384, 448, 512, 576, 704, 768, 832, 896, 960, 1024]
          - Affected layers: 0
      - source: "palu_dim_dist æ•°æ® (ä¸åŒæ¨¡å‹)"
        path: "results/palu_dim_dist/llama3_r0.8/dims.json"
        observation: |
          retain_ratio=0.8 çš„æ¨¡å‹æœ‰ä¸å¯¹é½ç»´åº¦:
          per_head_dims: [114, 116, 117, 118, 120, 121, 122, 123, 124, 125]
          çº¦ 97% ä¸æ˜¯ 8 çš„å€æ•°

    root_cause_analysis:
      issue_1_model_already_aligned:
        description: "ratio=0.7 çš„ PaLU æ¨¡å‹äº§ç”Ÿå¯¹é½çš„ rank å€¼"
        detail: |
          PaLU çš„ Fisher ä¿¡æ¯ + å‡åŒ€é‡åŒ–ç­–ç•¥åœ¨ ratio=0.7 æ—¶
          äº§ç”Ÿçš„ rank å€¼æ°å¥½éƒ½æ˜¯ 32 çš„å€æ•°
        impact: "C5 å®éªŒçš„å‰ææ¡ä»¶ä¸å­˜åœ¨"

      issue_2_data_source_mismatch:
        description: "findings.yaml ä¸­ ~97% ä¸å¯¹é½çš„æ•°æ®æ¥è‡ªä¸åŒæ¨¡å‹"
        detail: |
          - palu_dim_dist åˆ†æçš„æ˜¯ retain_ratio=0.8
          - C5 å®éªŒä½¿ç”¨çš„æ˜¯ ratio=0.7
          è¿™æ˜¯ä¸¤ä¸ªä¸åŒçš„å‹ç¼©é…ç½®
        impact: "æ•°æ®ä¸ä¸€è‡´å¯¼è‡´é”™è¯¯é¢„æœŸ"

      issue_3_ranks_semantic:
        description: "HeadwiseLowRankModule.ranks æ˜¯ GROUP-level è€Œé per-head"
        detail: |
          ranks=[160, 160] è¡¨ç¤º 2 ä¸ª group å„æœ‰ rank=160
          ä¸æ˜¯ per-head çš„ç»´åº¦ï¼Œper-head dim = rank / heads_per_group
        impact: "ä»£ç é€»è¾‘æ­£ç¡®ä½†è§£é‡Šæœ‰è¯¯"

    difficulty_assessment:
      level: "HARD"
      rationale:
        - "ä¸æ˜¯ä»£ç  bugï¼Œæ˜¯å®éªŒè®¾è®¡å’Œæ¨¡å‹é€‰æ‹©é—®é¢˜"
        - "éœ€è¦è·å–æˆ–é‡æ–°å‹ç¼© retain_ratio=0.8 çš„ PaLU æ¨¡å‹"
        - "æˆ–è€…ä¿®æ”¹ PaLU å‹ç¼©å‚æ•°ç¦ç”¨å†…éƒ¨å¯¹é½çº¦æŸ"

    recommended_action: "é™çº§åˆ°æ–‡å­—ä¿®æ”¹æ–¹æ¡ˆ"

    text_modification_plan:
      - "æ›´æ–°è®ºæ–‡è¡¨è¿°ï¼Œæ˜ç¡® C5 ä½¿ç”¨çš„æ˜¯ ratio=0.7ï¼ˆå·²å¯¹é½ï¼‰"
      - "å°† dimension repair éªŒè¯é™åˆ¶åœ¨ C4 å¾®åŸºå‡†æµ‹è¯•"
      - "å¼ºè°ƒ ratio=0.8 ç­‰é«˜å‹ç¼©æ¯”åœºæ™¯ä¸‹ç»´åº¦åå¡Œæ›´ä¸¥é‡"
      - "ä¿ç•™ C4 çš„ +27% speedup ç»“è®ºä½œä¸ºä¸»è¦è¯æ®"

    alternative_if_e2e_required:
      - "è·å– retain_ratio=0.8 çš„å®Œæ•´ PaLU checkpoint"
      - "æˆ–ä½¿ç”¨ third_party/RAP/results ä¸­çš„ç»´åº¦æ•°æ®é‡æ–°å‹ç¼©æ¨¡å‹"
      - "é¢„è®¡éœ€è¦é¢å¤– 2-4 å°æ—¶ GPU æ—¶é—´"

# å…³é”®æ´å¯Ÿï¼ˆè·¨é˜¶æ®µï¼‰
key_insights:
  - id: "I1"
    insight: "ç»´åº¦å¯¹é½çš„å½±å“æ˜¯éçº¿æ€§çš„ï¼šå‡å°‘ FLOPs åè€Œå¢åŠ å»¶è¿Ÿ"
    supporting_findings: ["F1.1", "F1.2"]
    implications: "å‹ç¼©ç®—æ³•å¿…é¡»è€ƒè™‘ç¡¬ä»¶å¯¹é½çº¦æŸ"

  - id: "I2"
    insight: "ä½ç§© SVD å‹ç¼©ç†è®ºä¸Šä¼šäº§ç”Ÿä¸å¯¹é½ç»´åº¦ï¼Œä½†å®é™…å®ç°å¯èƒ½æœ‰å¯¹é½çº¦æŸ"
    supporting_findings: ["F1.3", "F1.4"]
    implications: "éœ€è¦åœ¨å‹ç¼©åæ·»åŠ ç»´åº¦ä¿®å¤ passï¼Œæˆ–åœ¨å‹ç¼©ç®—æ³•ä¸­å¼•å…¥å¯¹é½çº¦æŸ"
    caveat_added: "2026-01-26"
    status: "REQUIRES CLARIFICATION"
    caveat: |
      ã€é‡è¦æ¾„æ¸…ã€‘2026-01-26 æœ€ç»ˆç¡®è®¤ï¼š
      - ~97% ä¸å¯¹é½æ•°æ®æ¥è‡ª RAP çš„ç†è®ºåˆ†æï¼Œéå®é™… PaLU å‹ç¼©ç»“æœ
      - å®é™… PaLU checkpoint (ratio 0.5-0.9) å…¨éƒ¨ 100% å¯¹é½
      - PaLU ä½¿ç”¨ Fisher + å‡åŒ€é‡åŒ–ç­–ç•¥ï¼Œå¼ºåˆ¶ rank å¯¹é½åˆ° 32 çš„å€æ•°
      - ç»´åº¦åå¡Œé—®é¢˜å­˜åœ¨äºï¼š(1) æœªé‡åŒ–çš„ SVD å‹ç¼©ï¼Œ(2) ç†è®º rank åˆ†é…
      - è®ºæ–‡ scope éœ€è¦æ˜ç¡®è¿™ä¸€ç‚¹

  - id: "I5"
    date: "2026-01-26"
    insight: "PaLU å®ç°ä½¿ç”¨é‡åŒ–çº¦æŸï¼Œå¼ºåˆ¶ rank å¯¹é½åˆ° 32 çš„å€æ•°"
    supporting_findings: ["F5.1", "F5.4"]
    status: "CORRECTED"
    original_hypothesis: |
      (é”™è¯¯) ratio=0.8 äº§ç”Ÿ ~97% ä¸å¯¹é½ç»´åº¦
    corrected_understanding: |
      æ‰€æœ‰ PaLU checkpoint (ratio 0.5-0.9) éƒ½æ˜¯ 100% å¯¹é½çš„ã€‚
      ~97% ä¸å¯¹é½çš„æ•°æ®æ¥è‡ª RAP çš„ç†è®ºåˆ†æï¼Œéå®é™…å‹ç¼©ç»“æœã€‚
      PaLU çš„ Fisher + å‡åŒ€é‡åŒ–ç­–ç•¥ä¼šå°† rank å¯¹é½åˆ° 32 çš„å€æ•°ã€‚
    implications: |
      1. å½“å‰ PaLU å®ç°ä¸ä¼šäº§ç”Ÿç»´åº¦åå¡Œ
      2. ç»´åº¦åå¡Œå‘ç”Ÿåœ¨æœªé‡åŒ–çš„ SVD å‹ç¼©åœºæ™¯
      3. è®ºæ–‡éœ€è¦æ˜ç¡®è¯´æ˜è¿™ä¸€é™åˆ¶
      4. C4 å¾®åŸºå‡†ï¼ˆäººå·¥ä¸å¯¹é½ç»´åº¦ï¼‰ä»æ˜¯æœ‰æ•ˆè¯æ®

  - id: "I3"
    date: "2026-01-24"
    insight: "æ€§èƒ½å·®è·çš„æ ¹å› ä¸åœ¨ PyTorch åç«¯é€‰æ‹©å±‚ï¼Œè€Œåœ¨ FlashAttention å†…æ ¸å±‚"
    supporting_findings: ["F2.1.1", "F2.1.3", "F2.1.4"]
    implications: |
      1. ä¹‹å‰å‡è®¾çš„ã€ŒFlashAttention å›é€€åˆ° Mathã€æ˜¯é”™è¯¯çš„
      2. FlashAttention å¯¹é 8-aligned è¾“å…¥ä½¿ç”¨äº†æ…¢é€Ÿè·¯å¾„
      3. éœ€è¦æ·±å…¥ FlashAttention/CUTLASS æºç åˆ†æå…·ä½“åŸå› 
      4. ä¼˜åŒ–æ–¹å‘åº”èšç„¦äº CUDA kernel å±‚è€Œé PyTorch å±‚

  - id: "I4"
    date: "2026-01-24"
    insight: "ç¡¬ä»¶å±‚æ ¹å› å·²éªŒè¯ï¼šTensor Core å¯¹é½ + å‘é‡åŒ–åŠ è½½æ˜¯æ€§èƒ½å·®è·çš„ä¸»å› "
    supporting_findings: ["F2.3.1", "F2.3.3", "F2.3.4"]
    implications: |
      1. Tensor Core éœ€è¦ K % 16 == 0 è¾¾åˆ°æœ€ä¼˜åˆ©ç”¨ç‡ï¼ˆ~30% vs ~12%ï¼‰
      2. å‘é‡åŒ–åŠ è½½éœ€è¦ K % 8 == 0 ä½¿ç”¨ float4ï¼ˆvs scalarï¼‰
      3. L2 cache sector æµªè´¹ï¼ˆ5.8%ï¼‰ä¸æ˜¯ä¸»å› 
      4. è§£å†³æ–¹æ¡ˆï¼šæ˜¾å¼ padding åˆ° 8/16 å¯¹é½
      5. å¯è¿›å…¥ C3 å½¢å¼åŒ–é˜¶æ®µå®šä¹‰ Shape Contract

  - id: "F5.8"
    date: "2026-01-27"
    experiment: "M1_E2E_REPAIR (Job 18549)"
    finding: "RAP SVD E2E benchmark å®Œæˆï¼šDimension repair åœ¨ RAP SVD æ¶æ„ä¸‹æ²¡æœ‰å¸¦æ¥æ€§èƒ½æå‡"
    status: "COMPLETED"
    evidence_path: "results/rap_svd_e2e/20260127_131517/"
    confidence: "high"
    details:
      job_id: 18549
      node: "acclnode06"
      gpu: "A100 80GB PCIe"
      repair_applied:
        original_dim: 102
        repaired_dim: 104
        layers_repaired: "32/32"
        strategy: "minimal"
      prefill_results:
        - config: "batch=1, seq=512"
          misaligned_ms: 61.29
          repaired_ms: 63.06
          speedup_pct: -2.8
        - config: "batch=4, seq=512"
          misaligned_ms: 210.68
          repaired_ms: 216.23
          speedup_pct: -2.6
        - config: "batch=1, seq=1024"
          misaligned_ms: 125.87
          repaired_ms: 128.61
          speedup_pct: -2.1
        - config: "batch=4, seq=1024"
          misaligned_ms: 464.55
          repaired_ms: 467.80
          speedup_pct: -0.7
        - config: "batch=1, seq=2048"
          misaligned_ms: 290.47
          repaired_ms: 292.92
          speedup_pct: -0.8
        - config: "batch=4, seq=2048"
          misaligned_ms: 1134.18
          repaired_ms: 1134.55
          speedup_pct: -0.0
      decode_results:
        avg_speedup_pct: -0.7
        max_speedup_pct: -0.0
      summary:
        avg_prefill_speedup_pct: -1.5
        avg_decode_speedup_pct: -0.7
    key_observation: |
      **é‡è¦å‘ç°ï¼šRAP SVD æ¶æ„ä¸‹ dimension repair æ²¡æœ‰å¸®åŠ©ï¼**

      åŸå› åˆ†æï¼š
      1. RAP SVD åœ¨ latent space (k_rank_per_head=102) å­˜å‚¨å‹ç¼©è¡¨ç¤º
      2. ä½† SDPA å®é™…æ“ä½œå‘ç”Ÿåœ¨ k_proj_B æŠ•å½±åçš„ head_dim=128 ç©ºé—´
      3. head_dim=128 æ˜¯å®Œå…¨å¯¹é½çš„ï¼ŒSDPA ä¸å—å½±å“
      4. Repair åªå¢åŠ äº† latent GEMM çš„è®¡ç®—é‡ï¼Œæ²¡æœ‰æ”¹å–„ SDPA æ€§èƒ½

      è¿™æ˜¯ negative resultï¼Œä½†æ˜¯é‡è¦çš„ç§‘å­¦å‘ç°ï¼
    root_cause_analysis: |
      RAP SVD forward path:
      1. k_proj_A: hidden -> k_latent (102, MISALIGNED)
      2. KV cache å­˜å‚¨ k_latent
      3. k_proj_B: k_latent -> k_states (head_dim=128, ALIGNED)
      4. SDPA: Q @ K^T @ V (åœ¨ head_dim=128 ä¸Šï¼ŒALIGNED)

      ç»´åº¦ä¸å¯¹é½åªå½±å“ k_proj_A/B çš„ GEMMï¼Œä¸å½±å“ SDPAã€‚
      è€Œ repair å¢åŠ äº† latent space çš„è®¡ç®—å’Œå†…å­˜å¼€é”€ã€‚
    implications: |
      1. å¯¹äº SVD-based å‹ç¼© (RAP SVD)ï¼Œç»´åº¦ä¸å¯¹é½ä¸å½±å“ SDPA æ€§èƒ½
      2. Dimension repair å¯¹ RAP SVD æ— æ•ˆï¼Œä¸åº”ä½œä¸ºä¼˜åŒ–ç­–ç•¥
      3. è®ºæ–‡éœ€è¦æ˜ç¡® scopeï¼šrepair ä»…é€‚ç”¨äºç›´æ¥æ“ä½œä¸å¯¹é½ head_dim çš„åœºæ™¯
      4. C4 å¾®åŸºå‡†ï¼ˆç›´æ¥åœ¨ SDPA å±‚æµ‹è¯•ï¼‰ä»ç„¶æœ‰æ•ˆ
    paper_impact:
      section: "Section 5 (E2E Validation)"
      modification_needed: |
        - æ·»åŠ  RAP SVD E2E negative result
        - æ˜ç¡® dimension repair çš„é€‚ç”¨åœºæ™¯
        - å¼ºè°ƒ C4 å¾®åŸºå‡†ä»æ˜¯ä¸»è¦è¯æ®
        - è®¨è®ºä¸åŒå‹ç¼©æ¶æ„å¯¹ç»´åº¦æ•æ„Ÿæ€§çš„å·®å¼‚

# C1 é˜¶æ®µæ€»ç»“
C1_summary:
  status: "COMPLETED"
  date: "2026-01-24"
  key_numbers:
    - "88% å»¶è¿Ÿå¢åŠ  (head_dim 107 vs 96)"
    - "12.6x æ€§èƒ½å·®è· (Math vs Flash backend)"
    - "~97% PaLU å‹ç¼©ç»´åº¦ä¸å¯¹é½ (not % 8 == 0)"
  conclusion: "ç»´åº¦åå¡Œç°è±¡å·²å……åˆ†é‡åŒ–ï¼Œå¯è¿›å…¥ C2 åŸå› æ¢ç©¶é˜¶æ®µ"
